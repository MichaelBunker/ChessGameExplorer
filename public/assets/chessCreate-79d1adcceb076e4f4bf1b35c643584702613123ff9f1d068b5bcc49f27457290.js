var game=new Chess;statusEl=$("#status"),fenEl=$("#fen"),pgnEl=$("#pgn");var removeGreySquares=function(){$("#board .square-55d63").css("background","")},greySquare=function(e){var a=$("#board .square-"+e),n="#a9a9a9";a.hasClass("black-3c85d")===!0&&(n="#696969"),a.css("background",n)},onDragStart=function(e,a){return game.game_over()===!0||"w"===game.turn()&&-1!==a.search(/^b/)||"b"===game.turn()&&-1!==a.search(/^w/)?!1:void 0},onDrop=function(e,a){removeGreySquares();var n=game.move({from:e,to:a,promotion:"q"});if(null===n)return"snapback";updateStatus();var o=game.moves(),r=game.pgn(),t=game.turn();$.ajax({type:"GET",url:"/players",data:[r,o,t],dataType:"json",success:function(e,a,n){$("#moves_display").text(""),moveNumber=e.moves.length;for(var o=0;o<moveNumber;o++)$("#moves_display").append("<tr> <td> "+e.moves[0]+"</td><td>"+e.next_move[0]+"</td></tr>"),e.moves.splice(0,1),e.next_move.splice(0,1)}})},onMouseoverSquare=function(e,a){var n=game.moves({square:e,verbose:!0});if(0!==n.length){greySquare(e);for(var o=0;o<n.length;o++)greySquare(n[o].to)}},onMouseoutSquare=function(e,a){removeGreySquares()},onSnapEnd=function(){board.position(game.fen())},updateStatus=function(){var e="",a="White";"b"===game.turn()&&(a="Black"),game.in_checkmate()===!0?e="Game over, "+a+" is in checkmate.":game.in_draw()===!0?e="Game over, drawn position":(e=a+" to move",game.in_check()===!0&&(e+=", "+a+" is in check")),statusEl.html(e),fenEl.html(game.fen()),pgnEl.html(game.pgn())},cfg={draggable:!0,position:"start",onDragStart:onDragStart,onDrop:onDrop,onMouseoutSquare:onMouseoutSquare,onMouseoverSquare:onMouseoverSquare,onSnapEnd:onSnapEnd},board=ChessBoard("board",cfg);$("#startBtn").on("click",function(){board.start();new Chess("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");updateStatus()}),$("#clearBtn").on("click",function(){board.start(),board.clear(),game.reset(),statusEl.html(""),fenEl.html(""),pgnEl.html("")}),$("#undoBtn").on("click",function(){game.undo();var e=game.fen();board.position(e),updateStatus()});